<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Radio Days</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/extra.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">
  

</head>
<body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>


  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="one-half column" style="margin-top: 5%">
        <h1>Radio Days</h1>
      </div>
    </div>
    <div class="row">
      <div class="one-half column" style="margin-top: 5%">
        <h5>What is America listening to?</h5>
      </div>
    </div>   
    <div class="row">
      <div class="one-half column" >
        <p>Dolorem temporibus rem esse assumenda voluptas omnis. Incidunt molestias tenetur fugiat temporibus id deserunt. Necessitatibus dolores ut labore placeat quaerat expedita soluta fugit. Earum aut eaque soluta. Asperiores libero saepe porro et et quasi. Reprehenderit aut voluptatem recusandae nemo atque. Corrupti hic aut autem dolorem.</p>
      </div>
    </div>       
    <div class="row">
      <div class="twelve columns" style="margin-top: 5%; margin-bottom: 0">
        <div id="hovering"></div>
        <div id="controls" >
          <div class="modeL">Limbaugh</div>
          <div class="modeFAS">FAS</div>
        </div>
      </div>
    </div>
        <script type="text/javascript">

          // -------------------------------------------- Setup
          var width  = 1000,height = 590;
          var rateById = d3.map();
          var color = d3.scaleThreshold()
              .domain(d3.range(2, 10))
              .range(d3.schemePuBuGn[9]);
          var unemployment = d3.map();
          var path = d3.geoPath();
          var projection = d3.geoAlbers()
                        .scale(1280)
                        .translate([width / 2, height / 2]);
          var x = d3.scaleLinear()
            .domain([1, 10])
            .rangeRound([600, 860]);

          var svg = d3.select("body").append("svg")
              .attr("width", width)
              .attr("height", height);

          // // -------------------------------------------- Legend
          // var legend = svg.append("g")
          //         .attr("class", "key")
          //         .attr("transform", "translate(0,40)");         
                        
          // legend.selectAll("rect")
          //   .data(color.range().map(function(d) {
          //     if (d[0] == null) d[0] = x.domain()[0];
          //     if (d[1] == null) d[1] = x.domain()[1];
          //     return d;
          //   }).reverse())
          //   .enter().append("rect")
          //     .attr("height", 8)
          //     .attr("x", function(d,i) {return width/2 + i * 20})
          //     .attr("y", -20)
          //     .attr("width", 20)
          //     .style("fill", function(d){return d;}); 

          // legend.append("text")
          //     .attr("class", "caption")
          //     .attr("x", width/2)
          //     .attr("y", -26)
          //     .attr("fill", "#000")
          //     .attr("text-anchor", "start")
          //     .attr("font-weight", "bold")
          //     .text("Unemployment rate");   

          d3.queue()
              .defer(d3.json, "https://d3js.org/us-10m.v1.json")
              .defer(d3.tsv, "unemployment.tsv",  function(d) { unemployment.set(d.id, +d.rate); })
              .await(ready);


          function ready(error, us) {
            if (error) throw error;

            // -------------------------------------------- Unemployment

            svg.append("g")
                .attr("class", "counties")
              .selectAll("path")
              .data(topojson.feature(us, us.objects.counties).features)
              .enter().append("path")
                .attr("fill", function(d) { return color(d.rate = unemployment.get(d.id)); })
                .style("opacity", 0.8)
                .attr("d", path)
                .on("mouseover", function(){ 
                    d3.select(this).style("fill", "rgba(0,0,0,0.8)"); 
                })
                .on("mouseout", function(){ 
                    d3.select(this).style("fill", function(d) { return color(d.rate = unemployment.get(d.id)); })
                })  
              .append("title")
                .text(function(d) { return d.rate + "%"; });

            svg.append("path")
                .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
                .attr("class", "states")
                .attr("d", path);

            d3.json("dataMarket.json", function(error, dataMarket) {

              // -------------------------------------------- market
              var market = svg.selectAll("g.market")
                .data(dataMarket)
                .enter()
                .append("g")
                .attr("class", "market")
                .attr("transform", function(d) { 
                  if (d.long!==-1 && d.lat!==-1) {
                    return "translate(" + projection([d.long, d.lat]) + ")"; }
                  });

              //Limbaugh   
              market.append("circle")
                .attr("r", function(d) { return d.limbaughPercent;})
                .attr("class", "limbaugh")
                .style("opacity", 0)
                .style("stroke", "#000")
                .style("fill", "rgba(255, 255, 255, 0.7)")
                .on("mouseover", function(d){ 
                    d3.select(this).style("fill", "rgba(255, 255, 255, 1)"); 
                    document.getElementById("hovering").innerHTML = d.name;
                })              
                .on("mouseout", function(d){ 
                    d3.select(this).style("fill", "rgba(255, 255, 255, 0.7)"); 
                    document.getElementById("hovering").innerHTML = " ";
                })

              //FAS
              market.append("circle")
                .attr("r", function(d) { return d.fasPercent;})
                .attr("class", "fas")
                .style("opacity", 0)
                .style("stroke", "#000")
                .style("fill", "rgba(173, 140, 171, 0.8)")
                .on("mouseover", function(d){ 
                    d3.select(this).style("fill", "rgba(173, 140, 171, 1)"); 
                    document.getElementById("hovering").innerHTML = d.name;
                })              
                .on("mouseout", function(d){ 
                    d3.select(this).style("fill", "rgba(173, 140, 171, 0.8)"); 
                    document.getElementById("hovering").innerHTML = " ";
                })


                d3.selectAll('.limbaugh')
                    .filter(function(d) { return d.number < 50 })
                      .attr("class", "first");

                d3.selectAll('.limbaugh')
                    .filter(function(d) { return d.number > 50 && d.number < 100 })
                      .attr("class", "second");

                d3.selectAll('.limbaugh')
                    .filter(function(d) { return d.number > 100 && d.number < 200 })
                      .attr("class", "third");



                // show FAS
                d3.select(".modeL").on("click", function(d) { 
                  d3.selectAll(".fas").transition().style("opacity", 0);

                  d3.selectAll(".first")
                      .transition()
                      .delay(1000)
                      .style("opacity", 1)

                   d3.selectAll(".second")   
                      .transition() 
                      .delay(1400)
                      .style("opacity", 1)

                   d3.selectAll(".third")   
                      .transition() 
                      .delay(1800)
                      .style("opacity", 1)
                })              
                // show L
                d3.select(".modeFAS").on("click", function(d) { 
                  d3.selectAll(".fas").transition().delay(100).style("opacity", 1);

                  d3.selectAll(".first").transition().style("opacity", 0);
                  d3.selectAll(".second").transition().style("opacity", 0);
                  d3.selectAll(".third").transition().style("opacity", 0);
                })

            });   


          }

        </script>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
