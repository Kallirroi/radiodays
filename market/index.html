<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Radio Days - Market</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/extra.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">
  

</head>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/queue.v1.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>


  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="one-half column" style="margin-top: 5%">
        <h1>Radio Days - Market</h1>
      </div>
    </div>
    <div class="row">
      <div class="twelve columns">
        <div id="playing">Click on a bubble to listen to the radio market's livestream.</div>
        <div id="hovering">Hover over market to reveal name. </div>
        <script type="text/javascript">

          // -------------------------------------------- Setup
          var width  = 900,height = 590;
          var rateById = d3.map();
          var color =  d3.scale.linear().domain([2,10])
              .interpolate(d3.interpolateHcl)
              .range(["#f2f2d7","#77969A"]);
          var projection = d3.geo.albersUsa()
              .scale(1280)
              .translate([width / 2, height / 2]);
          var path = d3.geo.path()
              .projection(projection);
          var x = d3.scale.linear()
              .domain([1, 10])
              .rangeRound([600, 860]);

          var svg = d3.select("body").append("svg")
              .attr("width", width)
              .attr("height", height);
          
          queue()
              .defer(d3.json, "us-counties.json")
              .defer(d3.tsv, "Unemployment.tsv", function(d) { rateById.set(d.id, +d.rate); })
              .await(ready);


          function ready(error, us) {
            if (error) throw error;

            // -------------------------------------------- Simple
            svg.append("g")
                .attr("class", "counties")
                .selectAll("path")
                .data(topojson.feature(us, us.objects.counties).features)
                .enter().append("path")
                .attr("fill", "#77969A")
                .attr("d", path)
                .on("mouseover", function(){ 
                    d3.select(this).style("fill", "aliceblue"); 
                })
                .on("mouseout", function(){ 
                    d3.select(this).style("fill", "#77969A"); 
                })     


            // -------------------------------------------- Unemployment

            // svg.append("g")
            //     .attr("class", "counties")
            //     .selectAll("path")
            //     .data(topojson.feature(us, us.objects.counties).features)
            //     .enter().append("path")
            //     .attr("fill", function(d) { return color(rateById.get(d.id)); })
            //     .style("opacity", 0.8)
            //     .attr("d", path)
            //     .on("mouseover", function(){ 
            //         d3.select(this).style("fill", "aliceblue"); 
            //     })
            //     .on("mouseout", function(){ 
            //         d3.select(this).style("fill", function(d) { 
            //             return color(rateById.get(d.id)); 
            //         }); 
            //     })     

            svg.append("path")
                .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
                .attr("class", "states")
                .attr("d", path);


            d3.json("dataMarket.json", function(error, dataMarket) {

              // -------------------------------------------- market
              var market = svg.selectAll("g.market")
                .data(dataMarket)
                .enter()
                .append("g")
                .attr("class", "market")
                .attr("transform", function(d) { 
                  if (d.long!==-1 && d.lat!==-1) {
                    return "translate(" + projection([d.long, d.lat]) + ")"; }
                  });


              market.append("circle")
                .attr("r", function(d) { return d.limbaughPercent;})
                .style("fill", "#000")
                .style("opacity", 0.35)
                .on("mouseover", function(d){ 
                    d3.select(this).style("opacity", 0.85); 
                    document.getElementById("hovering").innerHTML = d.name;
                })              
                .on("mouseout", function(d){ 
                    d3.select(this).style("opacity", 0.35); 
                    document.getElementById("hovering").innerHTML = "Hover over market to reveal name.";
                })
                .on("click", function(d) { 
                  var audioElement = document.createElement('audio');
                  audioElement.setAttribute('src', d.live);
                  audioElement.play();
                  setTimeout(function() { audioElement.pause()}, 5000);
                  document.getElementById("playing").innerHTML = "Listening to: " + d.name;
                })              



                market.append("circle")
                .attr("r", function(d) { return d.fasPercent;})
                .style("fill", "#77969A")
                .style("opacity", 0.35)
                .on("mouseover", function(d){ 
                    d3.select(this).style("opacity", 0.85); 
                    document.getElementById("hovering").innerHTML = d.name;
                })              
                .on("mouseout", function(d){ 
                    d3.select(this).style("opacity", 0.35); 
                    document.getElementById("hovering").innerHTML = "Hover over market to reveal name.";
                })
                .on("click", function(d) { 
                  var audioElement = document.createElement('audio');
                  audioElement.setAttribute('src', d.live);
                  audioElement.play();
                  setTimeout(function() { audioElement.pause()}, 5000);
                  document.getElementById("playing").innerHTML = "Listening to: " + d.name;
                })

              // -------------------------------------------- Text

              // market.append("text")
              //   .attr("x", 5)
              //   .text(function(d) { return d.name; })
              //   .style("fill", "#000")
              //   .style("font-family", "Inter UI")
              //   .style("font-size", "10px")
              //   .style("font-weight", "600");
              
              // -------------------------------------------- Legend

              // var ls_w = 20, ls_h = 20;
              // var legend = svg.selectAll("g.legend")
              // .data(radio)
              // .enter()
              // .append("g")
              // .attr("class", "legend");

              // legend.append("rect")
              // .attr("x", 20)
              // .attr("y", function(d, i){ return height - (i*ls_h) - 2*ls_h;})
              // .attr("width", ls_w)
              // .attr("height", ls_h)
              // .style("fill", function(d, i) { return color(d); })
              // .style("opacity", 0.8);

              // legend.append("text")
              // .attr("x", 50)
              // .attr("y", function(d, i){ return height - (i*ls_h) - ls_h - 4;})
              // .text(function(d){ return d.band; });


            });   


          }

        </script>
      </div>
    </div>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
